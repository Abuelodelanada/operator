[tox]
requires =
    tox>=4.2
env_list =
    fix
    py311
    py38
    py37
    py36
    unit
    lint
skip_missing_interpreters = true

[testenv:fix]
description = Format the code base to adhere to our styles, and complain about what we cannot do automatically.
skip_install = true
deps =
    pre-commit>=3.2.2
commands =
    pre-commit run --all-files {posargs}
    python -c 'print(r"hint: run {envbindir}{/}pre-commit install to add checks as pre-commit hook")'

[testenv:unit]
description = unit tests
deps =
    coverage[toml]
    jsonpatch
    pytest
commands =
    coverage run \
      --source={[vars]src_path} \
      -m pytest -v --tb native --log-cli-level=INFO -s {posargs} {[vars]tst_path}
    coverage report

[testenv:lint]
description = lint
skip_install = true
deps =
    black
    coverage[toml]
    isort
    jsonpatch
    pytest
commands =
    black --check tests scenario
    isort --check-only --profile black tests scenario

[testenv:fmt]
description = Format code
skip_install = true
deps =
    black
    isort
commands =
    black tests scenario
    isort --profile black tests scenario

[vars]
src_path = {toxinidir}/scenario
tst_path = {toxinidir}/tests
